{"version":3,"file":"get_mootimeterstate.min.js","sources":["../src/get_mootimeterstate.js"],"sourcesContent":["import {call as fetchMany} from 'core/ajax';\nimport Log from 'core/log';\nimport {execReloadPage as reloadPage} from 'mod_mootimeter/reload_page';\n\nexport const init = (refreshintervall) => {\n\n    var obj = document.getElementById('mootimeterstate');\n    if (!obj) {\n        window.console.log(\"Early exit\");\n        return;\n    }\n\n    if (refreshintervall < 1000) {\n        refreshintervall = 1000;\n    }\n\n    initMootimeterstate();\n\n    setInterval(() => {\n        getMootimeterstate();\n    }, refreshintervall);\n};\n\n/**\n * Make the call to get the Mootimeterstate\n * @param {int} pageid\n * @param {int} cmid\n * @param {string} dataset\n * @returns {array}\n */\nconst getMootimeterstateExecute = (\n    pageid,\n    cmid,\n    dataset\n) => fetchMany([{\n    methodname: 'mod_mootimeter_get_mootimeterstate',\n    args: {\n        pageid,\n        cmid,\n        dataset\n    },\n}])[0];\n\nconst initMootimeterstate = async() => {\n\n    await getMootimeterstate();\n\n    var mtmstate = document.getElementById('mootimeterstate');\n    var dataset = mtmstate.dataset;\n    const queryString = window.location.search;\n    const urlParams = new URLSearchParams(queryString);\n    const cmid = urlParams.get('id');\n\n    if (urlParams.get('r')) {\n        dataset.r = urlParams.get('r');\n    }\n\n    if (urlParams.get('o')) {\n        dataset.o = urlParams.get('o');\n    }\n\n    var pageid = 0;\n    if (dataset.pageid) {\n        pageid = dataset.pageid;\n    } else if (urlParams.get('pageid')) {\n        pageid = urlParams.get('pageid');\n    }\n\n    await reloadPage(pageid, cmid, dataset);\n};\n\n/**\n * Executes the call to store input value.\n */\nexport const getMootimeterstate = async() => {\n    var mtmstate = document.getElementById('mootimeterstate');\n    var dataset = mtmstate.dataset;\n    const queryString = window.location.search;\n    const urlParams = new URLSearchParams(queryString);\n    const cmid = urlParams.get('id');\n\n    if (urlParams.get('r')) {\n        dataset.r = urlParams.get('r');\n    }\n\n    if (urlParams.get('o')) {\n        dataset.o = urlParams.get('o');\n    }\n\n    var pageid = 0;\n    if (dataset.pageid) {\n        pageid = dataset.pageid;\n    } else if (urlParams.get('pageid')) {\n        pageid = urlParams.get('pageid');\n    }\n\n    const response = await getMootimeterstateExecute(pageid, cmid, JSON.stringify(dataset));\n\n    if (response.code != 200) {\n        Log.error(response.string);\n    }\n\n    if (response.code == 200) {\n        const states = JSON.parse(response.state);\n\n        // Set all datasets to mootimeterstate.\n        for (let dataattribute in states) {\n            mtmstate.setAttribute('data-' + dataattribute, states[dataattribute]);\n        }\n\n        if (mtmstate.dataset.contentchangedat_prev != mtmstate.dataset.contentchangedat) {\n            mtmstate.setAttribute('data-settingschangedat_prev', 0);\n            mtmstate.setAttribute('data-contentlastupdated', 0);\n            reloadPage(pageid, cmid, dataset);\n        }\n    }\n\n};\n"],"names":["refreshintervall","document","getElementById","initMootimeterstate","setInterval","getMootimeterstate","window","console","log","async","dataset","queryString","location","search","urlParams","URLSearchParams","cmid","get","r","o","pageid","mtmstate","response","methodname","args","getMootimeterstateExecute","JSON","stringify","code","error","string","states","parse","state","dataattribute","setAttribute","contentchangedat_prev","contentchangedat"],"mappings":"yUAIqBA,mBAEPC,SAASC,eAAe,oBAM9BF,iBAAmB,MACnBA,iBAAmB,KAGvBG,sBAEAC,aAAY,KACRC,uBACDL,mBAZCM,OAAOC,QAAQC,IAAI,qBAmCrBL,oBAAsBM,gBAElBJ,yBAGFK,QADWT,SAASC,eAAe,mBAChBQ,cACjBC,YAAcL,OAAOM,SAASC,OAC9BC,UAAY,IAAIC,gBAAgBJ,aAChCK,KAAOF,UAAUG,IAAI,MAEvBH,UAAUG,IAAI,OACdP,QAAQQ,EAAIJ,UAAUG,IAAI,MAG1BH,UAAUG,IAAI,OACdP,QAAQS,EAAIL,UAAUG,IAAI,UAG1BG,OAAS,EACTV,QAAQU,OACRA,OAASV,QAAQU,OACVN,UAAUG,IAAI,YACrBG,OAASN,UAAUG,IAAI,iBAGrB,+BAAWG,OAAQJ,KAAMN,UAMtBL,mBAAqBI,cAC1BY,SAAWpB,SAASC,eAAe,mBACnCQ,QAAUW,SAASX,cACjBC,YAAcL,OAAOM,SAASC,OAC9BC,UAAY,IAAIC,gBAAgBJ,aAChCK,KAAOF,UAAUG,IAAI,MAEvBH,UAAUG,IAAI,OACdP,QAAQQ,EAAIJ,UAAUG,IAAI,MAG1BH,UAAUG,IAAI,OACdP,QAAQS,EAAIL,UAAUG,IAAI,UAG1BG,OAAS,EACTV,QAAQU,OACRA,OAASV,QAAQU,OACVN,UAAUG,IAAI,YACrBG,OAASN,UAAUG,IAAI,iBAGrBK,cAlEwB,EAC9BF,OACAJ,KACAN,WACC,cAAU,CAAC,CACZa,WAAY,qCACZC,KAAM,CACFJ,OAAAA,OACAJ,KAAAA,KACAN,QAAAA,YAEJ,GAuDuBe,CAA0BL,OAAQJ,KAAMU,KAAKC,UAAUjB,aAEzD,KAAjBY,SAASM,mBACLC,MAAMP,SAASQ,QAGF,KAAjBR,SAASM,KAAa,OAChBG,OAASL,KAAKM,MAAMV,SAASW,WAG9B,IAAIC,iBAAiBH,OACtBV,SAASc,aAAa,QAAUD,cAAeH,OAAOG,gBAGtDb,SAASX,QAAQ0B,uBAAyBf,SAASX,QAAQ2B,mBAC3DhB,SAASc,aAAa,8BAA+B,GACrDd,SAASc,aAAa,0BAA2B,mCACtCf,OAAQJ,KAAMN"}