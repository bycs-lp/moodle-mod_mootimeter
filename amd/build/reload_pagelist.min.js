define("mod_mootimeter/reload_pagelist",["exports","core/ajax","core/log","core/notification","core/templates","core/sortable_list","jquery","mod_mootimeter/utils"],(function(_exports,_ajax,_log,_notification,_templates,_sortable_list,_jquery,_utils){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=_exports.execReloadPagelist=void 0,_log=_interopRequireDefault(_log),_templates=_interopRequireDefault(_templates),_sortable_list=_interopRequireDefault(_sortable_list),_jquery=_interopRequireDefault(_jquery);_exports.init=pagerefreshintervall=>{document.getElementById("mootimeterstate")&&(pagerefreshintervall<500&&(pagerefreshintervall=500),setInterval((()=>{!function(){var pageid=0;document.getElementById("mootimeterstate").dataset.pageid&&("undefined"!=(pageid=document.getElementById("mootimeterstate").dataset.pageid)&&0!=pageid.length||(pageid=0));const queryString=window.location.search,cmid=new URLSearchParams(queryString).get("id");execReloadPagelist(pageid,cmid)}()}),pagerefreshintervall))};const reloadPagelist=(pageid,cmid,dataset)=>(0,_ajax.call)([{methodname:"mod_mootimeter_get_pages_list",args:{pageid:pageid,cmid:cmid,dataset:dataset}}])[0],execReloadPagelist=async function(pageid,cmid){let forcereload=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var mtmstate=document.getElementById("mootimeterstate"),dataset=mtmstate.dataset;if(mtmstate.dataset.pagelistchangedat_prev&&mtmstate.dataset.pagelistchangedat==mtmstate.dataset.pagelistchangedat_prev&&!forcereload)return;const queryString=window.location.search,urlParams=new URLSearchParams(queryString);urlParams.get("r")&&(dataset.r=urlParams.get("r")),urlParams.get("o")&&(dataset.o=urlParams.get("o")),dataset.useUrlParams=1;const response=await reloadPagelist(pageid,cmid,JSON.stringify(dataset));if(200!=response.code&&_log.default.error(response.string),200==response.code){const pagelist=JSON.parse(response.pagelist);_templates.default.renderForPromise("mod_mootimeter/elements/snippet_page_list",pagelist).then((_ref=>{let{html:html,js:js}=_ref;document.getElementById("mootimeter-addpage-button")&&document.getElementById("mootimeter-addpage-button").remove(),_templates.default.replaceNode(document.getElementById("mootimeter-pages-list"),html,js);var listelements=document.getElementsByClassName("mootimeter_pages_li");if(listelements[0]){var uniqid=listelements[0].dataset.uniqid;new _sortable_list.default("#mootimeter-pages-list",{moveHandlerSelector:".mootimeter_page_move_sortablehandle_"+uniqid}),(0,_jquery.default)(".mootimeter_pages_li_sortable_"+uniqid).on(_sortable_list.default.EVENTS.DROP,(async function(_,info){var newIndex=info.targetList.children().index(info.element);await storePagePosition(this.dataset.pageid,newIndex)}))}return document.querySelectorAll(".tooltip").forEach((e=>e.remove())),!0})).catch((error=>(0,_notification.exception)(error))),mtmstate.setAttribute("data-pagelistchangedat_prev",mtmstate.dataset.pagelistchangedat),document.querySelectorAll(".tooltip").forEach((e=>e.remove()))}};_exports.execReloadPagelist=execReloadPagelist;const storePagePosition=(pageid,newIndex)=>{(0,_utils.ajaxRequestInput)("mod_mootimeter_store_page_details",pageid,"sortorder",newIndex,"")}}));

//# sourceMappingURL=reload_pagelist.min.js.map