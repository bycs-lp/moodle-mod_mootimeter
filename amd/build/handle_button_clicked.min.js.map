{"version":3,"file":"handle_button_clicked.min.js","sources":["../src/handle_button_clicked.js"],"sourcesContent":["import {call as fetchMany} from 'core/ajax';\r\nimport Log from 'core/log';\r\nimport ModalSaveCancel from 'core/modal_save_cancel';\r\nimport ModalDeleteCancel from 'core/modal_delete_cancel';\r\nimport ModalEvents from 'core/modal_events';\r\nimport {get_string as getString} from 'core/str';\r\nimport {execReloadPage as reloadPage} from 'mod_mootimeter/reload_page';\r\n\r\nexport const init = async(uniqueID) => {\r\n    var obj = document.getElementById(uniqueID);\r\n\r\n    if (!document.getElementById(uniqueID)) {\r\n        return;\r\n    }\r\n\r\n    obj.addEventListener(\"click\", buttonClicked);\r\n    const pageid = document.getElementById('mootimeterstate').dataset.pageid;\r\n    var dataset = obj.dataset;\r\n    var confirmationTitleStr;\r\n    if (!obj.getAttribute(\"data-confirmationtitlestr\")) {\r\n        confirmationTitleStr = getString('delete', 'core');\r\n    } else {\r\n        confirmationTitleStr = dataset.confirmationtitlestr;\r\n    }\r\n\r\n    var confirmationQuestionStr;\r\n    if (!obj.getAttribute(\"data-confirmationquestionstr\")) {\r\n        confirmationQuestionStr = getString('areyousure');\r\n    } else {\r\n        confirmationQuestionStr = dataset.confirmationquestionstr;\r\n    }\r\n\r\n    var modal;\r\n    if (!obj.getAttribute(\"data-confirmationtype\")) {\r\n        window.console.log('No confirmationtype specified! Abort!');\r\n        return;\r\n    } else {\r\n        switch (dataset.confirmationtype) {\r\n            case 'DELETE_CANCEL':\r\n                modal = await ModalDeleteCancel.create({\r\n                    title: confirmationTitleStr,\r\n                    body: confirmationQuestionStr,\r\n                    pageid: pageid,\r\n                });\r\n                break;\r\n            case 'SAVE_CANCEL':\r\n                modal = await ModalSaveCancel.create({\r\n                    title: confirmationTitleStr,\r\n                    body: confirmationQuestionStr,\r\n                    pageid: pageid,\r\n                });\r\n                break;\r\n        }\r\n    }\r\n\r\n    modal.getRoot().on(ModalEvents.delete, function() {\r\n        var uniqueID = obj.id;\r\n        var ajaxmethode = obj.dataset.ajaxmethode;\r\n\r\n        buttonClickedHandle(pageid, uniqueID, ajaxmethode);\r\n    });\r\n\r\n    modal.getRoot().on(ModalEvents.save, function() {\r\n        var uniqueID = obj.id;\r\n        var ajaxmethode = obj.dataset.ajaxmethode;\r\n\r\n        buttonClickedHandle(pageid, uniqueID, ajaxmethode);\r\n    });\r\n\r\n    /**\r\n     * Store the value.\r\n     */\r\n    function buttonClicked() {\r\n        modal.show();\r\n    }\r\n};\r\n\r\n/**\r\n * Call to store input value\r\n * @param {int} pageid\r\n * @param {string} thisDataset\r\n * @param {string} ajaxmethode\r\n * @returns {mixed}\r\n */\r\nconst execButtonClicked = (\r\n    pageid,\r\n    thisDataset,\r\n    ajaxmethode\r\n) => fetchMany([{\r\n    methodname: ajaxmethode,\r\n    args: {\r\n        pageid,\r\n        thisDataset\r\n    },\r\n}])[0];\r\n\r\n/**\r\n * Executes the call to store input value.\r\n * @param {int} pageid\r\n * @param {string} uniqueID\r\n * @param {string} ajaxmethode\r\n */\r\nconst buttonClickedHandle = async(pageid, uniqueID, ajaxmethode) => {\r\n    var dataset = JSON.stringify(document.getElementById(uniqueID).dataset);\r\n    const response = await execButtonClicked(pageid, dataset, ajaxmethode);\r\n\r\n    if (response.code != 200) {\r\n        Log.error(response.string);\r\n    }\r\n\r\n    if (response.reload == true) {\r\n        const queryString = window.location.search;\r\n        const urlParams = new URLSearchParams(queryString);\r\n        reloadPage(urlParams.get('pageid'), urlParams.get('id'));\r\n    }\r\n};\r\n"],"names":["async","obj","document","getElementById","uniqueID","addEventListener","modal","show","pageid","dataset","confirmationTitleStr","confirmationQuestionStr","getAttribute","confirmationtitlestr","confirmationquestionstr","confirmationtype","ModalDeleteCancel","create","title","body","ModalSaveCancel","getRoot","on","ModalEvents","delete","id","ajaxmethode","buttonClickedHandle","save","window","console","log","JSON","stringify","response","thisDataset","methodname","args","execButtonClicked","code","error","string","reload","queryString","location","search","urlParams","URLSearchParams","get"],"mappings":"2qBAQoBA,MAAAA,eACZC,IAAMC,SAASC,eAAeC,cAE7BF,SAASC,eAAeC,iBAI7BH,IAAII,iBAAiB,oBA0DjBC,MAAMC,gBAzDJC,OAASN,SAASC,eAAe,mBAAmBM,QAAQD,WAE9DE,qBAOAC,wBAOAL,MAfAG,QAAUR,IAAIQ,WAKdC,qBAHCT,IAAIW,aAAa,6BAGKH,QAAQI,sBAFR,mBAAU,SAAU,QAS3CF,wBAHCV,IAAIW,aAAa,gCAGQH,QAAQK,yBAFR,mBAAU,cAMnCb,IAAIW,aAAa,iCAIVH,QAAQM,sBACP,gBACDT,YAAcU,6BAAkBC,OAAO,CACnCC,MAAOR,qBACPS,KAAMR,wBACNH,OAAQA,mBAGX,cACDF,YAAcc,2BAAgBH,OAAO,CACjCC,MAAOR,qBACPS,KAAMR,wBACNH,OAAQA,SAMxBF,MAAMe,UAAUC,GAAGC,sBAAYC,QAAQ,eAC/BpB,SAAWH,IAAIwB,GACfC,YAAczB,IAAIQ,QAAQiB,YAE9BC,oBAAoBnB,OAAQJ,SAAUsB,gBAG1CpB,MAAMe,UAAUC,GAAGC,sBAAYK,MAAM,eAC7BxB,SAAWH,IAAIwB,GACfC,YAAczB,IAAIQ,QAAQiB,YAE9BC,oBAAoBnB,OAAQJ,SAAUsB,qBAhCtCG,OAAOC,QAAQC,IAAI,gDAoErBJ,oBAAsB3B,MAAMQ,OAAQJ,SAAUsB,mBAC5CjB,QAAUuB,KAAKC,UAAU/B,SAASC,eAAeC,UAAUK,eACzDyB,cApBgB,EACtB1B,OACA2B,YACAT,eACC,cAAU,CAAC,CACZU,WAAYV,YACZW,KAAM,CACF7B,OAAAA,OACA2B,YAAAA,gBAEJ,GAUuBG,CAAkB9B,OAAQC,QAASiB,gBAErC,KAAjBQ,SAASK,mBACLC,MAAMN,SAASO,QAGA,GAAnBP,SAASQ,OAAgB,OACnBC,YAAcd,OAAOe,SAASC,OAC9BC,UAAY,IAAIC,gBAAgBJ,6CAC3BG,UAAUE,IAAI,UAAWF,UAAUE,IAAI"}