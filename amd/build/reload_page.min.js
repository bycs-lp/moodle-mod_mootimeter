define("mod_mootimeter/reload_page",["exports","core/ajax","core/log","core/notification","core/templates","mod_mootimeter/reload_pagelist","mod_mootimeter/utils","mod_mootimeter/get_mootimeterstate"],(function(_exports,_ajax,_log,_notification,_templates,_reload_pagelist,_utils,_get_mootimeterstate){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.reloadSettingsCol=_exports.reloadPageContent=_exports.reloadContentMenu=_exports.init=_exports.execReloadPage=void 0,_log=_interopRequireDefault(_log),_templates=_interopRequireDefault(_templates);_exports.init=uniqueID=>{const obj=document.getElementById(uniqueID);obj&&obj.addEventListener("click",(function(){var pageid=0,dataset="";this.dataset&&(pageid=this.dataset.pageid,dataset=this.dataset);null!=pageid&&"undefined"!=pageid&&0!=pageid.length||(pageid=0);const queryString=window.location.search,cmid=new URLSearchParams(queryString).get("id");execReloadPage(pageid,cmid,dataset)}))};const execReloadPage=async(pageid,cmid,dataset)=>{var mtmstate=document.getElementById("mootimeterstate");if(mtmstate.dataset.lockpagereload)return;dataset?Object.assign(dataset,(0,_utils.getGetParams)()):dataset=(0,_utils.getGetParams)(),dataset=JSON.stringify(dataset),0!=pageid&&await(0,_get_mootimeterstate.getMootimeterstate)(),mtmstate=document.getElementById("mootimeterstate");const response=await((pageid,cmid,dataset)=>(0,_ajax.call)([{methodname:"mod_mootimeter_get_pagecontentparams",args:{pageid:pageid,cmid:cmid,dataset:dataset}}])[0])(pageid,cmid,dataset);if(200!=response.code&&_log.default.error(response.string),200==response.code){const pageparmas=JSON.parse(response.pageparams);mtmstate.dataset.contentchangedat_prev&&mtmstate.dataset.contentchangedat_prev==mtmstate.contentchangedat&&mtmstate.dataset.teacherpermissiontoview_prev&&mtmstate.dataset.teacherpermissiontoview_prev==mtmstate.dataset.teacherpermissiontoviewteacherpermissiontoview||(reloadPageContent(pageparmas.pagecontent),(0,_reload_pagelist.execReloadPagelist)(pageid,cmid,!0)),mtmstate.dataset.pagecontentmenuchangedat_prev&&mtmstate.dataset.pagecontentmenuchangedat_prev==mtmstate.settingschangedat||reloadContentMenu(pageparmas.contentmenu),!pageparmas.colsettings||mtmstate.dataset.settingschangedat_prev&&mtmstate.dataset.settingschangedat_prev==mtmstate.settingschangedat||reloadSettingsCol(pageparmas.colsettings),pageparmas.pageid&&(mtmstate.setAttribute("data-pageid",pageparmas.pageid),(0,_utils.setGetParam)("pageid",pageparmas.pageid))}};_exports.execReloadPage=execReloadPage;const reloadSettingsCol=async pageparmas=>{var mtmstate=document.getElementById("mootimeterstate");_templates.default.renderForPromise(pageparmas.template,pageparmas).then((_ref=>{let{html:html,js:js}=_ref;return _templates.default.replaceNodeContents("#mootimeter-col-settings",html,js),mtmstate.setAttribute("data-settingschangedat_prev",mtmstate.dataset.settingschangedat),!0})).catch((error=>(0,_notification.exception)(error)))};_exports.reloadSettingsCol=reloadSettingsCol;const reloadContentMenu=async pageparmas=>{var mtmstate=document.getElementById("mootimeterstate");if(_templates.default.renderForPromise(pageparmas.template,pageparmas).then((_ref2=>{let{html:html,js:js}=_ref2;return _templates.default.replaceNode("#mootimeter-pagecontentmenu",html,js),mtmstate.setAttribute("data-pagecontentmenuchangedat_prev",mtmstate.dataset.pagecontentmenuchangedat),!0})).catch((error=>(0,_notification.exception)(error))),pageparmas.sp)for(const[key,value]of Object.entries(pageparmas.sp))(0,_utils.setGetParam)(key,value)};_exports.reloadContentMenu=reloadContentMenu;const reloadPageContent=async pageparmas=>{var mtmstate=document.getElementById("mootimeterstate");_templates.default.renderForPromise(pageparmas.template,pageparmas).then((_ref3=>{let{html:html,js:js}=_ref3;return _templates.default.replaceNodeContents("#mootimeter-pagecontent",html,js),mtmstate.setAttribute("data-contentchangedat_prev",mtmstate.dataset.contentchangedat),mtmstate.setAttribute("data-teacherpermissiontoview_prev",mtmstate.dataset.teacherpermissiontoview),!0})).catch((error=>(0,_notification.exception)(error)))};_exports.reloadPageContent=reloadPageContent}));

//# sourceMappingURL=reload_page.min.js.map