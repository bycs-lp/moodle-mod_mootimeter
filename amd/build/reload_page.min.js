define("mod_mootimeter/reload_page",["exports","core/ajax","core/log","core/notification","core/templates","mod_mootimeter/reload_pagelist"],(function(_exports,_ajax,_log,_notification,_templates,_reload_pagelist){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_log=_interopRequireDefault(_log),_templates=_interopRequireDefault(_templates);_exports.init=uniqueID=>{const obj=document.getElementById(uniqueID);obj&&obj.addEventListener("click",(function(){var pageid=this.dataset.pageid;const queryString=window.location.search,cmid=new URLSearchParams(queryString).get("id");execReloadPage(pageid,cmid)}))};const execReloadPage=async(pageid,cmid)=>{const response=await((pageid,cmid)=>(0,_ajax.call)([{methodname:"mod_mootimeter_get_pagecontentparams",args:{pageid:pageid,cmid:cmid}}])[0])(pageid,cmid);if(200!=response.code&&_log.default.error(response.string),200==response.code){var mtmstate=document.getElementById("mootimeterstate");const pageparmas=JSON.parse(response.pageparams);mtmstate.setAttribute("data-pageid",pageparmas.pageid),_templates.default.renderForPromise(pageparmas.pagecontent.template,pageparmas.pagecontent).then((_ref=>{let{html:html,js:js}=_ref;return _templates.default.replaceNodeContents("#mootimeter-pagecontent",html,js),!0})).catch((error=>(0,_notification.exception)(error))),_templates.default.renderForPromise(pageparmas.contentmenu.template,pageparmas.contentmenu).then((_ref2=>{let{html:html,js:js}=_ref2;return _templates.default.replaceNode("#mootimeter-pagecontentmenu",html,js),!0})).catch((error=>(0,_notification.exception)(error))),function(key,value){if(history.pushState){var params=new URLSearchParams(window.location.search);params.set(key,value);var newUrl=window.location.origin+window.location.pathname+"?"+params.toString();window.history.pushState({path:newUrl},"",newUrl)}}("pageid",pageparmas.pageid),(0,_reload_pagelist.execReloadPagelist)(pageid,cmid,!0),document.querySelectorAll(".tooltip").forEach((e=>e.remove()))}}}));

//# sourceMappingURL=reload_page.min.js.map