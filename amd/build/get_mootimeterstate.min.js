define("mod_mootimeter/get_mootimeterstate",["exports","core/ajax","core/log","mod_mootimeter/reload_page"],(function(_exports,_ajax,_log,_reload_page){var obj;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=_exports.getMootimeterstate=void 0,_log=(obj=_log)&&obj.__esModule?obj:{default:obj};_exports.init=refreshintervall=>{document.getElementById("mootimeterstate")?(refreshintervall<1e3&&(refreshintervall=1e3),initMootimeterstate(),setInterval((()=>{getMootimeterstate()}),refreshintervall)):window.console.log("Early exit")};const initMootimeterstate=async()=>{await getMootimeterstate();var dataset=document.getElementById("mootimeterstate").dataset;const queryString=window.location.search,urlParams=new URLSearchParams(queryString),cmid=urlParams.get("id");urlParams.get("r")&&(dataset.r=urlParams.get("r")),urlParams.get("o")&&(dataset.o=urlParams.get("o"));var pageid=0;dataset.pageid?pageid=dataset.pageid:urlParams.get("pageid")&&(pageid=urlParams.get("pageid")),await(0,_reload_page.execReloadPage)(pageid,cmid,dataset)},getMootimeterstate=async()=>{var mtmstate=document.getElementById("mootimeterstate"),dataset=mtmstate.dataset;const queryString=window.location.search,urlParams=new URLSearchParams(queryString),cmid=urlParams.get("id");urlParams.get("r")&&(dataset.r=urlParams.get("r")),urlParams.get("o")&&(dataset.o=urlParams.get("o"));var pageid=0;dataset.pageid?pageid=dataset.pageid:urlParams.get("pageid")&&(pageid=urlParams.get("pageid"));const response=await((pageid,cmid,dataset)=>(0,_ajax.call)([{methodname:"mod_mootimeter_get_mootimeterstate",args:{pageid:pageid,cmid:cmid,dataset:dataset}}])[0])(pageid,cmid,JSON.stringify(dataset));if(200!=response.code&&_log.default.error(response.string),200==response.code){const states=JSON.parse(response.state);for(let dataattribute in states)mtmstate.setAttribute("data-"+dataattribute,states[dataattribute]);mtmstate.dataset.contentchangedat_prev!=mtmstate.dataset.contentchangedat&&(mtmstate.setAttribute("data-settingschangedat_prev",0),mtmstate.setAttribute("data-contentlastupdated",0),(0,_reload_page.execReloadPage)(pageid,cmid,dataset))}};_exports.getMootimeterstate=getMootimeterstate}));

//# sourceMappingURL=get_mootimeterstate.min.js.map