{"version":3,"file":"toggle_state.min.js","sources":["../src/toggle_state.js"],"sourcesContent":["import {call as fetchMany} from 'core/ajax';\r\nimport Log from 'core/log';\r\nimport {execReloadPage as reloadPage} from 'mod_mootimeter/reload_page';\r\n\r\n/**\r\n * Initializing this module.\r\n * @param {*} ids consists of two elements [containerid, iconid]\r\n */\r\nexport const init = (ids) => {\r\n\r\n    const containerid = ids[0];\r\n\r\n    var obj = document.getElementById(containerid);\r\n\r\n    if (!document.getElementById(containerid)) {\r\n        return;\r\n    }\r\n\r\n    obj.addEventListener(\"click\", toggleState);\r\n\r\n    /**\r\n     * Store the value.\r\n     */\r\n    function toggleState() {\r\n        var pageid = this.dataset.pageid;\r\n        var containerid = this.id;\r\n        var iconid = this.dataset.iconid;\r\n        exectoggleState(pageid, containerid, iconid);\r\n    }\r\n};\r\n\r\n/**\r\n * Call to store input value\r\n * @param {int} pageid\r\n * @param {string} statename\r\n * @returns {mixed}\r\n */\r\nconst storeInputValue = (\r\n    pageid,\r\n    statename\r\n) => fetchMany([{\r\n    methodname: 'mod_mootimeter_toggle_state',\r\n    args: {\r\n        pageid,\r\n        statename\r\n    },\r\n}])[0];\r\n\r\n/**\r\n * Executes the call to store input value.\r\n * @param {int} pageid\r\n * @param {string} containerid\r\n * @param {string} iconid\r\n */\r\nconst exectoggleState = async(pageid, containerid, iconid) => {\r\n    var statename = document.getElementById(containerid).dataset.togglename;\r\n    const response = await storeInputValue(pageid, statename);\r\n\r\n    if (response.code != 200) {\r\n        Log.error(response.string);\r\n    }\r\n\r\n    if (response.code == 200) {\r\n\r\n        var element = document.getElementById(containerid);\r\n        var dataset = element.dataset;\r\n\r\n        document.getElementById(iconid).classList.remove(dataset.iconenabled);\r\n        document.getElementById(iconid).classList.remove(dataset.icondisabled);\r\n\r\n        if (response.newstate == 1) {\r\n            document.getElementById(iconid).classList.add(dataset.iconenabled);\r\n            document.getElementById(containerid).setAttribute('data-original-title', dataset.tooltipdisabled);\r\n        }\r\n\r\n        if (response.newstate != 1) {\r\n            document.getElementById(iconid).classList.add(dataset.icondisabled);\r\n            document.getElementById(containerid).setAttribute('data-original-title', dataset.tooltipenabled);\r\n        }\r\n\r\n        // To force the webservice to pull all results.\r\n        let nodelastupdated = document.getElementById('mootimeterstate');\r\n        nodelastupdated.setAttribute('data-lastupdated', 0);\r\n\r\n        const queryString = window.location.search;\r\n        const urlParams = new URLSearchParams(queryString);\r\n        const cmid = urlParams.get('id');\r\n        dataset.useUrlParams = 1;\r\n        reloadPage(dataset.pageid, cmid, dataset);\r\n    }\r\n};\r\n"],"names":["ids","containerid","obj","document","getElementById","addEventListener","pageid","this","dataset","id","iconid","exectoggleState","async","statename","togglename","response","methodname","args","storeInputValue","code","error","string","classList","remove","iconenabled","icondisabled","newstate","add","setAttribute","tooltipdisabled","tooltipenabled","queryString","window","location","search","cmid","URLSearchParams","get","useUrlParams"],"mappings":"sSAQqBA,YAEXC,YAAcD,IAAI,OAEpBE,IAAMC,SAASC,eAAeH,aAE7BE,SAASC,eAAeH,cAI7BC,IAAIG,iBAAiB,wBAMbC,OAASC,KAAKC,QAAQF,OACtBL,YAAcM,KAAKE,GACnBC,OAASH,KAAKC,QAAQE,OAC1BC,gBAAgBL,OAAQL,YAAaS,kBA2BvCC,gBAAkBC,MAAMN,OAAQL,YAAaS,cAC3CG,UAAYV,SAASC,eAAeH,aAAaO,QAAQM,iBACvDC,cAnBc,EACpBT,OACAO,aACC,cAAU,CAAC,CACZG,WAAY,8BACZC,KAAM,CACFX,OAAAA,OACAO,UAAAA,cAEJ,GAUuBK,CAAgBZ,OAAQO,cAE1B,KAAjBE,SAASI,mBACLC,MAAML,SAASM,QAGF,KAAjBN,SAASI,KAAa,KAGlBX,QADUL,SAASC,eAAeH,aAChBO,QAEtBL,SAASC,eAAeM,QAAQY,UAAUC,OAAOf,QAAQgB,aACzDrB,SAASC,eAAeM,QAAQY,UAAUC,OAAOf,QAAQiB,cAEhC,GAArBV,SAASW,WACTvB,SAASC,eAAeM,QAAQY,UAAUK,IAAInB,QAAQgB,aACtDrB,SAASC,eAAeH,aAAa2B,aAAa,sBAAuBpB,QAAQqB,kBAG5D,GAArBd,SAASW,WACTvB,SAASC,eAAeM,QAAQY,UAAUK,IAAInB,QAAQiB,cACtDtB,SAASC,eAAeH,aAAa2B,aAAa,sBAAuBpB,QAAQsB,iBAI/D3B,SAASC,eAAe,mBAC9BwB,aAAa,mBAAoB,SAE3CG,YAAcC,OAAOC,SAASC,OAE9BC,KADY,IAAIC,gBAAgBL,aACfM,IAAI,MAC3B7B,QAAQ8B,aAAe,kCACZ9B,QAAQF,OAAQ6B,KAAM3B"}