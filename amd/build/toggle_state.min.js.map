{"version":3,"file":"toggle_state.min.js","sources":["../src/toggle_state.js"],"sourcesContent":["import {call as fetchMany} from 'core/ajax';\nimport Log from 'core/log';\nimport {execReloadPage as reloadPage} from 'mod_mootimeter/reload_page';\n\nexport const init = (uniqueID) => {\n    var obj = document.getElementById(uniqueID);\n\n    if (!document.getElementById(uniqueID)) {\n        return;\n    }\n\n    obj.addEventListener(\"click\", toggleState);\n\n    /**\n     * Store the value.\n     */\n    function toggleState() {\n        var pageid = this.dataset.pageid;\n        var uniqueID = this.id;\n        exectoggleState(pageid, uniqueID);\n    }\n};\n\n/**\n * Call to store input value\n * @param {int} pageid\n * @param {string} statename\n * @returns {mixed}\n */\nconst storeInputValue = (\n    pageid,\n    statename\n) => fetchMany([{\n    methodname: 'mod_mootimeter_toggle_state',\n    args: {\n        pageid,\n        statename\n    },\n}])[0];\n\n/**\n * Executes the call to store input value.\n * @param {int} pageid\n * @param {string} uniqueID\n */\nconst exectoggleState = async(pageid, uniqueID) => {\n    var statename = document.getElementById(uniqueID).dataset.togglename;\n    const response = await storeInputValue(pageid, statename);\n\n    if (response.code != 200) {\n        Log.error(response.string);\n    }\n\n    if (response.code == 200) {\n\n        var element = document.getElementById(uniqueID);\n        var dataset = element.dataset;\n        var iconid = dataset.iconid;\n\n        document.getElementById(iconid).classList.remove(dataset.iconenabled);\n        document.getElementById(iconid).classList.remove(dataset.icondisabled);\n\n        if (response.newstate == 1) {\n            document.getElementById(iconid).classList.add(dataset.iconenabled);\n            document.getElementById(uniqueID).setAttribute('data-original-title', dataset.tooltipdisabled);\n        }\n\n        if (response.newstate != 1) {\n            document.getElementById(iconid).classList.add(dataset.icondisabled);\n            document.getElementById(uniqueID).setAttribute('data-original-title', dataset.tooltipenabled);\n        }\n\n        // To force the webservice to pull all results.\n        let nodelastupdated = document.getElementById('mootimeterstate');\n        nodelastupdated.setAttribute('data-lastupdated', 0);\n\n        const queryString = window.location.search;\n        const urlParams = new URLSearchParams(queryString);\n        const cmid = urlParams.get('id');\n        dataset.useUrlParams = 1;\n        reloadPage(dataset.pageid, cmid, dataset);\n    }\n};"],"names":["uniqueID","obj","document","getElementById","addEventListener","pageid","this","dataset","id","exectoggleState","async","statename","togglename","response","methodname","args","storeInputValue","code","error","string","iconid","classList","remove","iconenabled","icondisabled","newstate","add","setAttribute","tooltipdisabled","tooltipenabled","queryString","window","location","search","cmid","URLSearchParams","get","useUrlParams"],"mappings":"sSAIqBA,eACbC,IAAMC,SAASC,eAAeH,UAE7BE,SAASC,eAAeH,WAI7BC,IAAIG,iBAAiB,wBAMbC,OAASC,KAAKC,QAAQF,OACtBL,SAAWM,KAAKE,GACpBC,gBAAgBJ,OAAQL,oBA0B1BS,gBAAkBC,MAAML,OAAQL,gBAC9BW,UAAYT,SAASC,eAAeH,UAAUO,QAAQK,iBACpDC,cAlBc,EACpBR,OACAM,aACC,cAAU,CAAC,CACZG,WAAY,8BACZC,KAAM,CACFV,OAAAA,OACAM,UAAAA,cAEJ,GASuBK,CAAgBX,OAAQM,cAE1B,KAAjBE,SAASI,mBACLC,MAAML,SAASM,QAGF,KAAjBN,SAASI,KAAa,KAGlBV,QADUL,SAASC,eAAeH,UAChBO,QAClBa,OAASb,QAAQa,OAErBlB,SAASC,eAAeiB,QAAQC,UAAUC,OAAOf,QAAQgB,aACzDrB,SAASC,eAAeiB,QAAQC,UAAUC,OAAOf,QAAQiB,cAEhC,GAArBX,SAASY,WACTvB,SAASC,eAAeiB,QAAQC,UAAUK,IAAInB,QAAQgB,aACtDrB,SAASC,eAAeH,UAAU2B,aAAa,sBAAuBpB,QAAQqB,kBAGzD,GAArBf,SAASY,WACTvB,SAASC,eAAeiB,QAAQC,UAAUK,IAAInB,QAAQiB,cACtDtB,SAASC,eAAeH,UAAU2B,aAAa,sBAAuBpB,QAAQsB,iBAI5D3B,SAASC,eAAe,mBAC9BwB,aAAa,mBAAoB,SAE3CG,YAAcC,OAAOC,SAASC,OAE9BC,KADY,IAAIC,gBAAgBL,aACfM,IAAI,MAC3B7B,QAAQ8B,aAAe,kCACZ9B,QAAQF,OAAQ6B,KAAM3B"}