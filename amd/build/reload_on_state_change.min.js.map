{"version":3,"file":"reload_on_state_change.min.js","sources":["../src/reload_on_state_change.js"],"sourcesContent":["/**\n * Listen to a state change. If changed, reload the page.\n */\n\nimport {call as fetchMany} from 'core/ajax';\n\n\nexport const init = (statename) => {\n    var obj = document.getElementById('mootimeterstate');\n\n    if (!obj) {\n        window.console.log('mootimeterstate not found');\n        return;\n    }\n\n    if (!obj.dataset.pageid) {\n        window.console.log('Pageid not set in mootimeterstate');\n        return;\n    }\n\n    if (!statename) {\n        window.console.log('Statename not set in methods argument');\n        return;\n    }\n    setInterval(function () {\n        getState(obj.dataset.pageid, statename);\n    }, 1000);\n};\n\n/**\n * Call to create a new instance\n * @param {int} pageid\n * @param {string} statename\n * @returns\n */\nconst execGetState = (\n    pageid,\n    statename,\n) => fetchMany([{\n    methodname: 'mod_mootimeter_get_state',\n    args: {\n        pageid,\n        statename,\n    },\n}])[0];\n\n/**\n * Executes the call to create a new page.\n * @param {int} pageid\n * @param {string} statename\n */\nconst getState = async (pageid, statename) => {\n    const response = await execGetState(pageid, statename);\n\n    if (response.code != 200) {\n        window.console.log(response.string);\n    }\n\n    if (response.code == 200) {\n\n        if (!document.getElementById('mootimeterstate').dataset[statename]) {\n            document.getElementById('mootimeterstate').setAttribute('data-' + statename, response.state);\n        }\n\n        if (document.getElementById('mootimeterstate').dataset[statename] != response.state) {\n            location.reload();\n        }\n    }\n};"],"names":["statename","obj","document","getElementById","dataset","pageid","setInterval","getState","window","console","log","async","response","methodname","args","execGetState","code","string","setAttribute","state","location","reload"],"mappings":"4LAOqBA,gBACbC,IAAMC,SAASC,eAAe,mBAE7BF,IAKAA,IAAIG,QAAQC,OAKZL,UAILM,aAAY,WACRC,SAASN,IAAIG,QAAQC,OAAQL,aAC9B,KALCQ,OAAOC,QAAQC,IAAI,yCALnBF,OAAOC,QAAQC,IAAI,qCALnBF,OAAOC,QAAQC,IAAI,oCAwCrBH,SAAWI,MAAON,OAAQL,mBACtBY,cAjBW,EACjBP,OACAL,aACC,cAAU,CAAC,CACZa,WAAY,2BACZC,KAAM,CACFT,OAAAA,OACAL,UAAAA,cAEJ,GAQuBe,CAAaV,OAAQL,WAEvB,KAAjBY,SAASI,MACTR,OAAOC,QAAQC,IAAIE,SAASK,QAGX,KAAjBL,SAASI,OAEJd,SAASC,eAAe,mBAAmBC,QAAQJ,YACpDE,SAASC,eAAe,mBAAmBe,aAAa,QAAUlB,UAAWY,SAASO,OAGtFjB,SAASC,eAAe,mBAAmBC,QAAQJ,YAAcY,SAASO,OAC1EC,SAASC"}