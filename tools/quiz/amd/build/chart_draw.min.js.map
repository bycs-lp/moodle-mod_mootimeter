{"version":3,"file":"chart_draw.min.js","sources":["../src/chart_draw.js"],"sourcesContent":["import ChartJS from 'mootimetertool_quiz/chart.umd';\nimport {call as fetchMany} from 'core/ajax';\nimport {execReloadPage as reloadPage} from 'mod_mootimeter/reload_page';\n\nexport const init = (id) => {\n\n    if (!document.getElementById(id)) {\n        return;\n    }\n\n    const pageid = document.getElementById('mootimeterstate').dataset.pageid;\n\n    getAnswersAsync(pageid, id);\n\n    setTimeout(() => {\n        const intervalms = document.getElementById('mootimeterstate').dataset.refreshinterval;\n        const interval = setInterval(() => {\n            if (!document.getElementById(id)) {\n                clearInterval(interval);\n                return;\n            }\n            getAnswers(pageid, id);\n        }, intervalms);\n    }, 2000);\n\n};\n\n/**\n * This is because the execution should be finished befor proceeding.\n * @param {int} pageid\n * @param {string} id\n */\nasync function getAnswersAsync(pageid, id) {\n    await getAnswers(pageid, id);\n}\n\n/**\n * Execute the ajax call to get the aswers and more important data.\n * @param {int} pageid\n * @returns {mixed}\n */\nconst execGetAnswers = (\n    pageid,\n) => fetchMany([{\n    methodname: 'mootimetertool_quiz_get_answers',\n    args: {\n        pageid,\n    },\n}])[0];\n\n/**\n * Get the answers and other important data, as well as processing them.\n * @param {int} pageid\n * @param {string} id\n * @returns {mixed}\n */\nconst getAnswers = async (pageid, id) => {\n\n    const mtmstate = document.getElementById('mootimeterstate');\n\n    // Early exit if there are no changes.\n    if (mtmstate.dataset.lastupdated == mtmstate.dataset.contentchangedat) {\n        return;\n    }\n\n    const response = await execGetAnswers(pageid);\n\n    if (!document.getElementById(id)) {\n        window.console.log(\"Canvas not found\");\n        return;\n    }\n\n    // Write the new data to the canvas data attributes.\n    mtmstate.setAttribute('data-lastupdated', response.lastupdated);\n\n    let nodecanvas = document.getElementById(id);\n    nodecanvas.setAttribute('data-labels', response.labels);\n    nodecanvas.setAttribute('data-values', response.values);\n    nodecanvas.setAttribute('data-chartsettings', response.chartsettings);\n\n    // (Re-)Draw the chart.\n    var config = {\n        type: JSON.parse(response.chartsettings).charttype,\n        data: {\n            labels: JSON.parse(response.labels),\n            datasets: [{\n                label: response.question,\n                data: JSON.parse(response.values),\n                backgroundColor: JSON.parse(response.chartsettings).backgroundColor,\n                borderRadius: JSON.parse(response.chartsettings).borderRadius,\n                pointStyle: JSON.parse(response.chartsettings).pointStyle,\n                pointRadius: JSON.parse(response.chartsettings).pointRadius,\n                pointHoverRadius: JSON.parse(response.chartsettings).pointHoverRadius,\n            }]\n        },\n        options: JSON.parse(response.chartsettings).options\n    };\n\n    let chartStatus = ChartJS.getChart(id); // <canvas> id\n    if (chartStatus != undefined) {\n        chartStatus.destroy();\n    }\n\n    new ChartJS(document.getElementById(id), config);\n    ChartJS.defaults.font.size = 25;\n    ChartJS.defaults.stepSize = 1;\n};\n"],"names":["id","document","getElementById","pageid","dataset","getAnswers","getAnswersAsync","setTimeout","intervalms","refreshinterval","interval","setInterval","clearInterval","async","mtmstate","lastupdated","contentchangedat","response","methodname","args","execGetAnswers","window","console","log","setAttribute","nodecanvas","labels","values","chartsettings","config","type","JSON","parse","charttype","data","datasets","label","question","backgroundColor","borderRadius","pointStyle","pointRadius","pointHoverRadius","options","chartStatus","ChartJS","getChart","undefined","destroy","defaults","font","size","stepSize"],"mappings":"oUAIqBA,SAEZC,SAASC,eAAeF,iBAIvBG,OAASF,SAASC,eAAe,mBAAmBE,QAAQD,uBAsBvCA,OAAQH,UAC7BK,WAAWF,OAAQH,IArBzBM,CAAgBH,OAAQH,IAExBO,YAAW,WACDC,WAAaP,SAASC,eAAe,mBAAmBE,QAAQK,gBAChEC,SAAWC,aAAY,KACpBV,SAASC,eAAeF,IAI7BK,WAAWF,OAAQH,IAHfY,cAAcF,YAInBF,cACJ,YAiCDH,WAAaQ,MAAOV,OAAQH,YAExBc,SAAWb,SAASC,eAAe,sBAGrCY,SAASV,QAAQW,aAAeD,SAASV,QAAQY,8BAI/CC,cAvBNd,CAAAA,SACC,cAAU,CAAC,CACZe,WAAY,kCACZC,KAAM,CACFhB,OAAAA,WAEJ,GAiBuBiB,CAAejB,YAEjCF,SAASC,eAAeF,gBACzBqB,OAAOC,QAAQC,IAAI,oBAKvBT,SAASU,aAAa,mBAAoBP,SAASF,iBAE/CU,WAAaxB,SAASC,eAAeF,IACzCyB,WAAWD,aAAa,cAAeP,SAASS,QAChDD,WAAWD,aAAa,cAAeP,SAASU,QAChDF,WAAWD,aAAa,qBAAsBP,SAASW,mBAGnDC,OAAS,CACTC,KAAMC,KAAKC,MAAMf,SAASW,eAAeK,UACzCC,KAAM,CACFR,OAAQK,KAAKC,MAAMf,SAASS,QAC5BS,SAAU,CAAC,CACPC,MAAOnB,SAASoB,SAChBH,KAAMH,KAAKC,MAAMf,SAASU,QAC1BW,gBAAiBP,KAAKC,MAAMf,SAASW,eAAeU,gBACpDC,aAAcR,KAAKC,MAAMf,SAASW,eAAeW,aACjDC,WAAYT,KAAKC,MAAMf,SAASW,eAAeY,WAC/CC,YAAaV,KAAKC,MAAMf,SAASW,eAAea,YAChDC,iBAAkBX,KAAKC,MAAMf,SAASW,eAAec,oBAG7DC,QAASZ,KAAKC,MAAMf,SAASW,eAAee,aAG5CC,YAAcC,eAAQC,SAAS9C,IAChB+C,MAAfH,aACAA,YAAYI,cAGZH,eAAQ5C,SAASC,eAAeF,IAAK6B,uBACjCoB,SAASC,KAAKC,KAAO,kBACrBF,SAASG,SAAW"}