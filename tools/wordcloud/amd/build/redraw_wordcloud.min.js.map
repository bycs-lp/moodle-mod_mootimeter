{"version":3,"file":"redraw_wordcloud.min.js","sources":["../src/redraw_wordcloud.js"],"sourcesContent":["import { call as fetchMany } from 'core/ajax';\nimport WordCloud from 'mootimetertool_wordcloud/wordcloud2';\n\nexport const init = () => {\n\n    setInterval(function () {\n        getAnswers();\n    }, 1000);\n};\n\n/**\n * Call to get all answers\n * @param {int} pageid\n * @param {int} lastupdated\n * @returns {array}\n */\nconst execGetAnswers = (\n    pageid,\n    lastupdated\n) => fetchMany([{\n    methodname: 'mootimetertool_wordcloud_get_answers',\n    args: {\n        pageid,\n        lastupdated\n    },\n}])[0];\n\n/**\n * Executes the call to get all answers.\n */\nconst getAnswers = async () => {\n\n    var pageid = document.getElementById('wordcloudcanvas').dataset.pageid;\n    var lastposttimestamp = document.getElementById('mootimeterstate').dataset.lastupdated;\n\n    const response = await execGetAnswers(pageid, lastposttimestamp);\n\n    console.log([response.lastupdated, lastposttimestamp]);\n    if (response.lastupdated == lastposttimestamp) {\n        return;\n    }\n\n    // Set lastupdated.\n    let nodelastupdated = document.getElementById('mootimeterstate');\n    nodelastupdated.setAttribute('data-lastupdated', response.lastupdated);\n\n    // Redraw wordcloud.\n    document.getElementById('wordcloudcanvas').setAttribute('data-answers', JSON.stringify(response.answerlist));\n    console.log(JSON.stringify(response.answerlist));\n    redrawwordcloud();\n\n    return;\n};\n\n/**\n * Redraw the wordcloud.\n */\nfunction redrawwordcloud() {\n    console.log(\"Redraw\");\n    let mtmtcanvas = document.getElementById('wordcloudcanvas');\n    let answers = JSON.parse(mtmtcanvas.dataset.answers);\n    console.log(answers);\n\n    WordCloud(mtmtcanvas, { list: answers, weightFactor: 24, color: '#f98012', fontFamily: 'OpenSans' });\n}\n"],"names":["setInterval","getAnswers","async","pageid","document","getElementById","dataset","lastposttimestamp","lastupdated","response","methodname","args","execGetAnswers","console","log","setAttribute","JSON","stringify","answerlist","mtmtcanvas","answers","parse","list","weightFactor","color","fontFamily","redrawwordcloud"],"mappings":"uTAGoB,KAEhBA,aAAY,WACRC,eACD,YAuBDA,WAAaC,cAEXC,OAASC,SAASC,eAAe,mBAAmBC,QAAQH,OAC5DI,kBAAoBH,SAASC,eAAe,mBAAmBC,QAAQE,kBAErEC,cAnBa,EACnBN,OACAK,eACC,cAAU,CAAC,CACZE,WAAY,uCACZC,KAAM,CACFR,OAAAA,OACAK,YAAAA,gBAEJ,GAUuBI,CAAeT,OAAQI,sBAE9CM,QAAQC,IAAI,CAACL,SAASD,YAAaD,oBAC/BE,SAASD,aAAeD,yBAKNH,SAASC,eAAe,mBAC9BU,aAAa,mBAAoBN,SAASD,aAG1DJ,SAASC,eAAe,mBAAmBU,aAAa,eAAgBC,KAAKC,UAAUR,SAASS,aAChGL,QAAQC,IAAIE,KAAKC,UAAUR,SAASS,wBAUpCL,QAAQC,IAAI,cACRK,WAAaf,SAASC,eAAe,mBACrCe,QAAUJ,KAAKK,MAAMF,WAAWb,QAAQc,SAC5CP,QAAQC,IAAIM,gCAEFD,WAAY,CAAEG,KAAMF,QAASG,aAAc,GAAIC,MAAO,UAAWC,WAAY,aAdvFC"}