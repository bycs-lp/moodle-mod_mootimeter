{"version":3,"file":"redraw_wordcloud.min.js","sources":["../src/redraw_wordcloud.js"],"sourcesContent":["import Ajax from 'core/ajax';\nimport notification from 'core/notification';\nimport WordCloud from 'mootimetertool_wordcloud/wordcloud2';\n\nexport const init = () => {\n    setInterval(function () {\n        var pageid = document.getElementById('wordcloudcanvas').dataset.pageid;\n        var lastposttimestamp = document.getElementById('mootimeterstate').dataset.lastupdated;\n        const promise = Ajax.call([{\n            methodname: 'mootimetertool_wordcloud_get_answers',\n            args: {\n                pageid: pageid,\n                lastupdated: 0\n            },\n            fail: notification.exception,\n        }]);\n\n        promise[0].then(function (results) {\n            if (results.lastupdated == lastposttimestamp) {\n                return;\n            }\n\n            // Set lastupdated.\n            let nodelastupdated = document.getElementById('mootimeterstate');\n            nodelastupdated.setAttribute('data-lastupdated', results.lastupdated);\n\n            // Redraw wordcloud.\n            document.getElementById('wordcloudcanvas').setAttribute('data-answers', JSON.stringify(results.answerlist));\n            document.getElementById('wordcloudcanvas').dispatchEvent(new Event(\"redrawwordcloud\"));\n\n            return;\n        }).fail();\n\n    }, 1000);\n\n    redrawwordcloud();\n\n    new Event(\"redrawwordcloud\");\n    let mtmtcanvas = document.getElementById('wordcloudcanvas');\n    mtmtcanvas.addEventListener(\n        \"redrawwordcloud\",\n        () => {\n            redrawwordcloud();\n        },\n        false\n    );\n\n    /**\n     *\n     */\n    function redrawwordcloud() {\n        let mtmtcanvas = document.getElementById('wordcloudcanvas');\n        let answers = JSON.parse(mtmtcanvas.dataset.answers);\n        WordCloud(mtmtcanvas, { list: answers, weightFactor: 24, color: '#f98012', fontFamily: 'OpenSans' });\n    }\n};\n"],"names":["redrawwordcloud","mtmtcanvas","document","getElementById","answers","JSON","parse","dataset","list","weightFactor","color","fontFamily","setInterval","pageid","lastposttimestamp","lastupdated","Ajax","call","methodname","args","fail","notification","exception","then","results","setAttribute","stringify","answerlist","dispatchEvent","Event","addEventListener"],"mappings":"2eAIoB,cA8CPA,sBACDC,WAAaC,SAASC,eAAe,mBACrCC,QAAUC,KAAKC,MAAML,WAAWM,QAAQH,gCAClCH,WAAY,CAAEO,KAAMJ,QAASK,aAAc,GAAIC,MAAO,UAAWC,WAAY,aAhD3FC,aAAY,eACJC,OAASX,SAASC,eAAe,mBAAmBI,QAAQM,OAC5DC,kBAAoBZ,SAASC,eAAe,mBAAmBI,QAAQQ,YAC3DC,cAAKC,KAAK,CAAC,CACvBC,WAAY,uCACZC,KAAM,CACFN,OAAQA,OACRE,YAAa,GAEjBK,KAAMC,sBAAaC,aAGf,GAAGC,MAAK,SAAUC,YAClBA,QAAQT,aAAeD,yBAKLZ,SAASC,eAAe,mBAC9BsB,aAAa,mBAAoBD,QAAQT,aAGzDb,SAASC,eAAe,mBAAmBsB,aAAa,eAAgBpB,KAAKqB,UAAUF,QAAQG,aAC/FzB,SAASC,eAAe,mBAAmByB,cAAc,IAAIC,MAAM,uBAGpET,SAEJ,KAEHpB,sBAEI6B,MAAM,mBACO3B,SAASC,eAAe,mBAC9B2B,iBACP,mBACA,KACI9B,qBAEJ"}