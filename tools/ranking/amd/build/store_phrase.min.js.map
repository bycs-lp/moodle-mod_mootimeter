{"version":3,"file":"store_phrase.min.js","sources":["../src/store_phrase.js"],"sourcesContent":["import {call as fetchMany} from 'core/ajax';\nimport {execReloadPage as reloadPage} from 'mod_mootimeter/reload_page';\nimport {renderInfoBox} from 'mod_mootimeter/utils';\nimport {removeInfoBox} from 'mod_mootimeter/utils';\nimport {delay} from 'mod_mootimeter/utils';\n\nexport const init = (inputid, enterid) => {\n\n    // Register event to input box.\n    const ao = document.getElementById(inputid);\n    if (ao) {\n        ao.addEventListener(\"keyup\", function (event) {\n            if (event.code === 'Enter' || event.code === 'NumpadEnter') {\n                store(inputid);\n            }\n        });\n    }\n\n        // Register event to submit button.\n        const ae = document.getElementById(enterid);\n        if (ae) {\n            ae.addEventListener(\"click\", function () {\n                store(inputid);\n        });\n    }\n\n        /**\n         * Create new page.\n         * @param {string} inputid\n         */\n        function store(inputid) {\n            var pageid = document.getElementById(inputid).dataset.pageid;\n            var phrase = document.getElementById(inputid).value;\n            storePhrase(pageid, phrase, inputid);\n    }\n};\n\n/**\n * Call to store an phrase\n * @param {int} pageid\n * @param {string} phrase\n * @returns {array}\n */\nconst execStorePhrase = (\n    pageid,\n    phrase,\n) => fetchMany([{\n    methodname: 'mootimetertool_ranking_store_phrase',\n    args: {\n        pageid,\n        phrase\n    },\n}])[0];\n\n/**\n * Executes the call to store an phrase.\n * @param {int} pageid\n * @param {string} phrase\n * @param {string} inputid\n */\nconst storePhrase = async (pageid, phrase, inputid) => {\n\n    // Disable the input field until the page is refreshed.\n    document.getElementById(inputid).disabled = true;\n\n    const response = await execStorePhrase(pageid, phrase);\n\n    const infoboxid = \"mtmt_phrase_warning\";\n\n    removeInfoBox(infoboxid);\n\n    if (response.code == 1000 || response.code == 1001 || response.code == 1002) {\n        renderInfoBox(\"mtmt_tool-colct-header\", infoboxid, \"warning\", response.string);\n        document.getElementById(inputid).disabled = false;\n        document.getElementById(inputid).focus();\n    }\n\n    if (response.code == 200) {\n        const queryString = window.location.search;\n        const urlParams = new URLSearchParams(queryString);\n        await reloadPage(urlParams.get('pageid'), urlParams.get('id'));\n\n        // Now set the focus to the input field.\n\n        // Yes, it is not nice, but the dom needs some time to be updated.\n        await delay(100);\n\n        var elements = document.getElementsByClassName(\"mtmt-wc-phraseinput\");\n        for (var i = 0; i < elements.length; i++) {\n            if (elements.item(i).autofocus == true) {\n                elements.item(i).focus();\n            }\n        }\n    }\n};\n"],"names":["inputid","enterid","ao","document","getElementById","addEventListener","event","code","store","ae","pageid","dataset","phrase","value","storePhrase","async","disabled","response","methodname","args","execStorePhrase","string","focus","queryString","window","location","search","urlParams","URLSearchParams","get","elements","getElementsByClassName","i","length","item","autofocus"],"mappings":"kQAMoB,CAACA,QAASC,iBAGpBC,GAAKC,SAASC,eAAeJ,SAC/BE,IACAA,GAAGG,iBAAiB,SAAS,SAAUC,OAChB,UAAfA,MAAMC,MAAmC,gBAAfD,MAAMC,MAChCC,MAAMR,kBAMRS,GAAKN,SAASC,eAAeH,kBAW1BO,MAAMR,aACPU,OAASP,SAASC,eAAeJ,SAASW,QAAQD,OAClDE,OAAST,SAASC,eAAeJ,SAASa,MAC9CC,YAAYJ,OAAQE,OAAQZ,SAb5BS,IACAA,GAAGJ,iBAAiB,SAAS,WACzBG,MAAMR,mBAsChBc,YAAcC,MAAOL,OAAQE,OAAQZ,WAGvCG,SAASC,eAAeJ,SAASgB,UAAW,QAEtCC,cAtBc,EACpBP,OACAE,UACC,cAAU,CAAC,CACZM,WAAY,sCACZC,KAAM,CACFT,OAAAA,OACAE,OAAAA,WAEJ,GAauBQ,CAAgBV,OAAQE,oCAE7B,uBAIG,KAAjBK,SAASV,MAAiC,MAAjBU,SAASV,MAAiC,MAAjBU,SAASV,gCAC7C,yBALA,sBAKqC,UAAWU,SAASI,QACvElB,SAASC,eAAeJ,SAASgB,UAAW,EAC5Cb,SAASC,eAAeJ,SAASsB,SAGhB,KAAjBL,SAASV,KAAa,OAChBgB,YAAcC,OAAOC,SAASC,OAC9BC,UAAY,IAAIC,gBAAgBL,mBAChC,+BAAWI,UAAUE,IAAI,UAAWF,UAAUE,IAAI,aAKlD,gBAAM,aAERC,SAAW3B,SAAS4B,uBAAuB,uBACtCC,EAAI,EAAGA,EAAIF,SAASG,OAAQD,IACC,GAA9BF,SAASI,KAAKF,GAAGG,WACjBL,SAASI,KAAKF,GAAGV"}